<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>How to Run - Data Quality Testing Framework</title>
  <meta name="description" content="Setup and execution instructions for the Data Quality Testing Framework with step-by-step guide and troubleshooting tips.">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/dq-style.css">
</head>
<body>
  <!-- Navigation -->
  <nav class="project-nav">
    <div class="project-nav-container">
      <div class="project-nav-title">Data Quality Testing Framework</div>
      <div class="project-nav-links">
        <a href="index.html" class="project-nav-link">Overview</a>
        <a href="https://a-chmielewski.github.io/data-quality-testing-framework/index.html" target="_blank" class="project-nav-link">GX Docs</a>
        <a href="https://a-chmielewski.github.io/data-quality-testing-framework/dashboard.html" target="_blank" class="project-nav-link">Dashboard</a>
        <a href="../index.html" class="project-nav-link back-to-portfolio">‚Üê Portfolio</a>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="project-hero">
    <div class="hero-container">
      <div class="hero-badge">Setup Guide</div>
      <h1 class="hero-title">
        <span class="gradient-text">How to Run</span>
      </h1>
      <p class="hero-subtitle">
        Complete setup and execution instructions for running the Data Quality Testing Framework locally. Follow these steps to install dependencies, execute the pipeline, and view validation results.
      </p>
    </div>
  </section>

  <!-- Prerequisites -->
  <section class="content-section">
    <div class="container">
      <h2 class="section-title">Prerequisites</h2>
      <p class="section-subtitle">Required software and tools</p>
      
      <div class="feature-grid">
        <div class="feature-card">
          <h3>Python 3.11+</h3>
          <p>Required for running data ingestion scripts, dbt transformations, and Great Expectations validations. Verify installation:</p>
          <div class="code-block">
            <pre><code>python --version
# Should output: Python 3.11.x or higher</code></pre>
          </div>
        </div>

        <div class="feature-card">
          <h3>pip (Python Package Manager)</h3>
          <p>Used to install all Python dependencies from requirements.txt. Usually comes bundled with Python installation.</p>
          <div class="code-block">
            <pre><code>pip --version
# Should output pip version info</code></pre>
          </div>
        </div>

        <div class="feature-card">
          <h3>make (Optional but Recommended)</h3>
          <p>Automation tool for running pipeline stages. On Windows, use Git Bash, WSL, or run commands manually from Makefile.</p>
          <div class="code-block">
            <pre><code>make --version
# Should output GNU Make version</code></pre>
          </div>
        </div>
      </div>

      <div class="info-box">
        <p><strong>Note:</strong> All commands below assume you're running from the project root directory. If you don't have make installed, you can run the Python scripts directly as shown in the "Manual Execution" section below.</p>
      </div>
    </div>
  </section>

  <!-- Installation -->
  <section class="content-section" style="background: var(--bg-secondary);">
    <div class="container">
      <h2 class="section-title">Installation</h2>
      <p class="section-subtitle">Clone the repository and install dependencies</p>
      
      <div class="code-block">
        <pre><code># 1. Clone the repository
git clone https://github.com/a-chmielewski/data-quality-testing-framework.git
cd data-quality-testing-framework

# 2. (Optional) Create a virtual environment
python -m venv venv

# Activate virtual environment
# On Windows:
venv\Scripts\activate
# On macOS/Linux:
source venv/bin/activate

# 3. Install dependencies
make init
# OR manually:
pip install -r requirements.txt</code></pre>
      </div>

      <div class="feature-grid">
        <div class="feature-card">
          <h3>Key Dependencies</h3>
          <ul>
            <li><strong>duckdb:</strong> Embedded analytics database</li>
            <li><strong>dbt-duckdb:</strong> dbt adapter for DuckDB</li>
            <li><strong>great-expectations:</strong> Data quality framework</li>
            <li><strong>pandera:</strong> Schema validation library</li>
            <li><strong>pandas:</strong> Data manipulation</li>
            <li><strong>requests:</strong> HTTP library for API calls</li>
            <li><strong>plotly:</strong> Visualization library</li>
          </ul>
        </div>

        <div class="feature-card">
          <h3>Project Structure After Setup</h3>
          <div class="code-block">
            <pre><code>data-quality-testing-framework/
‚îú‚îÄ‚îÄ data/              # Raw CSV exports
‚îú‚îÄ‚îÄ duckdb/            # DuckDB database files
‚îú‚îÄ‚îÄ dbt/               # dbt project
‚îú‚îÄ‚îÄ gx/                # Great Expectations
‚îú‚îÄ‚îÄ scripts/           # Python scripts
‚îú‚îÄ‚îÄ artifacts/         # Output metrics
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ Makefile</code></pre>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Running the Pipeline -->
  <section class="content-section">
    <div class="container">
      <h2 class="section-title">Running the Pipeline</h2>
      <p class="section-subtitle">Execute the complete data quality pipeline</p>
      
      <div class="code-block">
        <pre><code># Option 1: Run complete pipeline (all stages)
make all

# Option 2: Run individual stages
make fetch       # Fetch data from NYC API
make dbt         # Run dbt transformations
make gx          # Initialize Great Expectations (first run only)
make checkpoint  # Run quality validations
make metrics     # Generate dashboard metrics</code></pre>
      </div>

      <div class="architecture-flow">
        <div class="flow-step">
          <div class="flow-step-header">
            <span class="flow-step-icon">1Ô∏è‚É£</span>
            <h3 class="flow-step-title">make fetch</h3>
          </div>
          <p class="flow-step-description">Data Ingestion Stage</p>
          <ul>
            <li>Queries NYC Open Data API</li>
            <li>Fetches last 7 days + 2019 baseline</li>
            <li>Validates schemas with Pandera</li>
            <li>Exports CSV files to data/</li>
            <li>Loads into DuckDB raw schema</li>
          </ul>
          <div class="info-box" style="margin-top: 1rem;">
            <p><strong>Output:</strong> data/311_recent.csv, data/311_hist.csv, duckdb/nyc.duckdb</p>
          </div>
        </div>

        <div class="flow-step">
          <div class="flow-step-header">
            <span class="flow-step-icon">2Ô∏è‚É£</span>
            <h3 class="flow-step-title">make dbt</h3>
          </div>
          <p class="flow-step-description">dbt Transformations Stage</p>
          <ul>
            <li>Staging: stg_311.sql (type casting, dedup)</li>
            <li>Mart: fct_311_complaints.sql (business logic)</li>
            <li>Runs built-in data quality tests</li>
            <li>Generates lineage documentation</li>
          </ul>
          <div class="info-box" style="margin-top: 1rem;">
            <p><strong>Output:</strong> Staging and mart tables in DuckDB</p>
          </div>
        </div>

        <div class="flow-step">
          <div class="flow-step-header">
            <span class="flow-step-icon">3Ô∏è‚É£</span>
            <h3 class="flow-step-title">make gx</h3>
          </div>
          <p class="flow-step-description">Great Expectations Setup</p>
          <ul>
            <li>Initializes GX context (first run only)</li>
            <li>Configures Pandas datasource</li>
            <li>Creates expectation suites</li>
            <li>Defines validation checkpoint</li>
          </ul>
          <div class="info-box" style="margin-top: 1rem;">
            <p><strong>Note:</strong> Only needs to run once unless you reset the GX configuration</p>
          </div>
        </div>

        <div class="flow-step">
          <div class="flow-step-header">
            <span class="flow-step-icon">4Ô∏è‚É£</span>
            <h3 class="flow-step-title">make checkpoint</h3>
          </div>
          <p class="flow-step-description">Quality Validation Stage</p>
          <ul>
            <li>Loads both datasets into validators</li>
            <li>Runs all expectation suites</li>
            <li>Generates HTML Data Docs</li>
            <li>Exits with code 1 if validations fail</li>
          </ul>
          <div class="info-box" style="margin-top: 1rem;">
            <p><strong>Output:</strong> gx/uncommitted/data_docs/local_site/index.html</p>
          </div>
        </div>

        <div class="flow-step">
          <div class="flow-step-header">
            <span class="flow-step-icon">5Ô∏è‚É£</span>
            <h3 class="flow-step-title">make metrics</h3>
          </div>
          <p class="flow-step-description">Metrics Generation Stage</p>
          <ul>
            <li>Computes row counts per dataset</li>
            <li>Calculates null ratios for columns</li>
            <li>Identifies top complaint types</li>
            <li>Exports JSON for dashboard</li>
          </ul>
          <div class="info-box" style="margin-top: 1rem;">
            <p><strong>Output:</strong> artifacts/metrics.json</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Manual Execution -->
  <section class="content-section" style="background: var(--bg-secondary);">
    <div class="container">
      <h2 class="section-title">Manual Execution (Without Make)</h2>
      <p class="section-subtitle">If you don't have make installed, run these commands directly</p>
      
      <div class="code-block">
        <pre><code># 1. Data Ingestion
python scripts/fetch_311.py

# 2. dbt Transformations
cd dbt
dbt run --profiles-dir .
cd ..

# 3. Great Expectations Setup (first run only)
python scripts/setup_gx.py

# 4. Quality Validation
python scripts/run_checkpoint.py

# 5. Metrics Generation
python scripts/build_metrics.py</code></pre>
      </div>
    </div>
  </section>

  <!-- Viewing Results -->
  <section class="content-section">
    <div class="container">
      <h2 class="section-title">Viewing Results</h2>
      <p class="section-subtitle">Access validation reports and dashboards</p>
      
      <div class="feature-grid">
        <div class="feature-card">
          <div class="feature-icon">‚úÖ</div>
          <h3>Great Expectations Data Docs</h3>
          <p>Open the auto-generated HTML report to view validation results, expectation suites, and data quality metrics.</p>
          <div class="code-block">
            <pre><code># On macOS
open gx/uncommitted/data_docs/local_site/index.html

# On Linux
xdg-open gx/uncommitted/data_docs/local_site/index.html

# On Windows
start gx\uncommitted\data_docs\local_site\index.html</code></pre>
          </div>
          <p style="margin-top: 1rem;"><strong>Online Version:</strong> <a href="https://a-chmielewski.github.io/data-quality-testing-framework/index.html" target="_blank" style="color: var(--accent-primary);">View Live Data Docs ‚Üí</a></p>
        </div>

        <div class="feature-card">
          <div class="feature-icon">üìä</div>
          <h3>Custom Plotly Dashboard</h3>
          <p>Open the interactive dashboard to explore metrics, complaint type distributions, and null rate analysis.</p>
          <div class="code-block">
            <pre><code># On macOS
open docs/dashboard.html

# On Linux
xdg-open docs/dashboard.html

# On Windows
start docs\dashboard.html</code></pre>
          </div>
          <p style="margin-top: 1rem;"><strong>Online Version:</strong> <a href="https://a-chmielewski.github.io/data-quality-testing-framework/dashboard.html" target="_blank" style="color: var(--accent-primary);">View Live Dashboard ‚Üí</a></p>
        </div>

        <div class="feature-card">
          <div class="feature-icon">üóÑÔ∏è</div>
          <h3>Query DuckDB Directly</h3>
          <p>Explore the data using DuckDB CLI or Python for custom analysis.</p>
          <div class="code-block">
            <pre><code># Install DuckDB CLI (optional)
pip install duckdb

# Query from command line
duckdb duckdb/nyc.duckdb

# Example queries:
SELECT COUNT(*) FROM raw.raw_311_recent;
SELECT * FROM staging.stg_311 LIMIT 10;
SELECT * FROM mart.fct_311_complaints;</code></pre>
          </div>
        </div>

        <div class="feature-card">
          <div class="feature-icon">üìà</div>
          <h3>Metrics JSON</h3>
          <p>The metrics.json file contains all computed KPIs for programmatic access or custom dashboards.</p>
          <div class="code-block">
            <pre><code># View metrics
cat artifacts/metrics.json

# Or use Python
import json
with open('artifacts/metrics.json') as f:
    metrics = json.load(f)
    print(metrics)</code></pre>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Troubleshooting -->
  <section class="content-section" style="background: var(--bg-secondary);">
    <div class="container">
      <h2 class="section-title">Troubleshooting</h2>
      <p class="section-subtitle">Common issues and solutions</p>
      
      <div class="feature-grid">
        <div class="feature-card">
          <h3>API Connection Issues</h3>
          <p><strong>Problem:</strong> fetch_311.py fails with connection timeout or 429 errors</p>
          <p><strong>Solution:</strong></p>
          <ul>
            <li>Check internet connection</li>
            <li>NYC Open Data API may have rate limits - wait and retry</li>
            <li>Verify API endpoint is accessible: <a href="https://data.cityofnewyork.us/resource/erm2-nwe9.json?$limit=1" target="_blank" style="color: var(--accent-primary);">Test API</a></li>
          </ul>
        </div>

        <div class="feature-card">
          <h3>DuckDB Lock Error</h3>
          <p><strong>Problem:</strong> Database is locked or in use by another process</p>
          <p><strong>Solution:</strong></p>
          <ul>
            <li>Close any open DuckDB connections</li>
            <li>Close Python processes accessing the database</li>
            <li>If persistent, delete duckdb/nyc.duckdb and re-run pipeline</li>
          </ul>
        </div>

        <div class="feature-card">
          <h3>dbt Command Not Found</h3>
          <p><strong>Problem:</strong> dbt command not recognized</p>
          <p><strong>Solution:</strong></p>
          <ul>
            <li>Ensure virtual environment is activated</li>
            <li>Reinstall dbt: pip install dbt-duckdb</li>
            <li>Verify installation: dbt --version</li>
          </ul>
        </div>

        <div class="feature-card">
          <h3>Great Expectations Validation Failures</h3>
          <p><strong>Problem:</strong> Checkpoint fails with validation errors</p>
          <p><strong>Solution:</strong></p>
          <ul>
            <li>This is expected behavior - check Data Docs for details</li>
            <li>Review specific failed expectations in HTML report</li>
            <li>Data quality issues may be real - investigate source data</li>
            <li>Adjust expectation thresholds if needed</li>
          </ul>
        </div>

        <div class="feature-card">
          <h3>Missing Dependencies</h3>
          <p><strong>Problem:</strong> ImportError or ModuleNotFoundError</p>
          <p><strong>Solution:</strong></p>
          <div class="code-block">
            <pre><code># Reinstall all dependencies
pip install -r requirements.txt --force-reinstall

# Or install individual package
pip install &lt;package-name&gt;</code></pre>
          </div>
        </div>

        <div class="feature-card">
          <h3>Dashboard Not Loading Metrics</h3>
          <p><strong>Problem:</strong> Dashboard shows "Loading..." indefinitely</p>
          <p><strong>Solution:</strong></p>
          <ul>
            <li>Ensure make metrics has been run successfully</li>
            <li>Verify artifacts/metrics.json exists and is valid JSON</li>
            <li>Check browser console for errors (F12)</li>
            <li>Try opening dashboard from file:// URL directly</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Best Practices -->
  <section class="content-section">
    <div class="container">
      <h2 class="section-title">Best Practices</h2>
      <p class="section-subtitle">Tips for optimal pipeline execution</p>
      
      <div class="feature-grid">
        <div class="feature-card">
          <div class="feature-icon">üîÑ</div>
          <h3>Regular Execution</h3>
          <p>Run the pipeline regularly (e.g., daily or weekly) to track data quality trends over time. Schedule with cron (Linux/macOS) or Task Scheduler (Windows).</p>
        </div>

        <div class="feature-card">
          <div class="feature-icon">üìù</div>
          <h3>Version Control</h3>
          <p>Track changes to expectation suites and dbt models in Git. This provides audit trails and enables rollback if needed.</p>
        </div>

        <div class="feature-card">
          <div class="feature-icon">üîç</div>
          <h3>Monitor Validation Results</h3>
          <p>Review Great Expectations Data Docs after each run. Failed validations indicate data quality issues that require investigation.</p>
        </div>

        <div class="feature-card">
          <div class="feature-icon">üß™</div>
          <h3>Test in Isolation</h3>
          <p>Use a virtual environment to avoid dependency conflicts. This ensures reproducibility across different machines.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="content-section" style="background: var(--bg-secondary);">
    <div class="container" style="text-align: center;">
      <h2 class="section-title" style="text-align: center;">Need Help?</h2>
      <p class="section-subtitle">Explore the project or reach out for support</p>
      
      <div class="hero-cta" style="justify-content: center;">
        <a href="https://github.com/a-chmielewski/data-quality-testing-framework" target="_blank" class="btn btn-primary">GitHub Repository</a>
        <a href="https://github.com/a-chmielewski/data-quality-testing-framework/issues" target="_blank" class="btn btn-secondary">Report an Issue</a>
        <a href="index.html" class="btn btn-secondary">Back to Overview</a>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer style="padding: 2rem 0; text-align: center; border-top: 1px solid var(--border-color);">
    <div class="container">
      <p style="color: var(--text-muted);">
        ¬© 2025 Aleksander Chmielewski | 
        <a href="https://github.com/a-chmielewski" target="_blank">GitHub</a> | 
        <a href="https://www.linkedin.com/in/a-chmielewski/" target="_blank">LinkedIn</a>
      </p>
    </div>
  </footer>

  <script>
    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
  </script>
</body>
</html>

